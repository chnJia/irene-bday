<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
  <title>Birthday hihi</title>
  <style>
    :root{
      --bg: #674a58;
      --card: #ffdbfb;
      --accent: #ff7ad9;
      --text: #f8e0ff;
      --muted: #8c5b89;
      --plate: #e9edf7;
      --cake1: #ffd8a8;
      --cake2: #ffc078;
      --cake3: #ffa94d;
      --icing: #fff1f7;
      --candle: #66d9e8;
      --wick: #333;
      --flame1: #ffd43b;
      --flame2: #ffa94d;
      --smoke: rgba(220,225,236,.85);
      --shadow: 0 20px 60px rgba(5,8,35,.55), 0 2px 10px rgba(5,8,35,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 700px at 80% -10%, #2a2c55 0%, var(--bg) 55%); color:var(--text);
      font-family: 'Inter', sans-serif;
      display:grid; place-items:center;
    }
    .app{ width:min(920px, 96vw); padding:24px; }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius:28px; padding:28px; box-shadow:var(--shadow);
      position:relative; overflow:hidden;
    }

    h1{
      margin:8px 0 6px; text-align:center; font-weight:900; letter-spacing:.4px;
      font-size: clamp(28px, 5vw, 48px);
      background: linear-gradient(90deg, #f9b0a3, #facd9d, #e7a47a, #e7c3ae, #ecd2bc);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }

    .stage{
      position:relative; height: 420px; display:grid; place-items:end center;
      margin: 18px auto 6px; 
      isolation:isolate;
    }

    canvas#confetti{ position:absolute; inset:0; pointer-events:none; z-index:0 }

    .cake-wrap{ 
      position:relative; z-index: 1; 
      transform: translateY(28px); 
    }
    .plate{
      width: 440px; height: 30px; border-radius: 999px; background: var(--plate);
      box-shadow: inset 0 10px 20px rgba(0,0,0,.12), 0 10px 40px rgba(0,0,0,.25);
      margin: -12px auto 0; /* dari 0 auto ke -12px auto 0, lebih naik */
      position:relative;
    }

    .cake{ width: 320px; margin: 0 auto; position:relative; }
    .layer{ height:80px; border-radius: 24px; position:relative; overflow:hidden; box-shadow: 0 12px 32px rgba(0,0,0,.18); }
    .layer:nth-child(1){ background:var(--cake3) }
    .layer:nth-child(2){ background:var(--cake2); transform: translateY(-16px); width: 86%; margin: 0 auto; }
    .layer:nth-child(3){ background:var(--cake1); transform: translateY(-28px); width: 72%; margin: 0 auto; }

    .icing{ position:absolute; left:0; right:0; top:0; height:40px; background: var(--icing); box-shadow: 0 10px 0 rgba(0,0,0,.06) inset; }
    .drip{ position:absolute; width:24px; background:var(--icing); border-bottom-left-radius:12px; border-bottom-right-radius:12px; }
    .d1{ left:32px; height:30px; top:24px }
    .d2{ left:90px; height:22px; top:24px }
    .d3{ right:60px; height:28px; top:24px }

    .candle{ 
      position:absolute; left:50%; 
      transform: translate(-50%, -50px); 
      bottom: 220px; width: 26px; height: 120px; 
      background: repeating-linear-gradient( -45deg, var(--candle), var(--candle) 10px, #4dc1d6 10px, #4dc1d6 18px ); 
      border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,.25); 
      display:flex; align-items:flex-start; justify-content:center; 
    }
    .wick{ width: 4px; height: 16px; background: var(--wick); border-radius: 2px; margin-top:-12px; }

    .flame{ position:absolute; top:-30px; left:50%; transform: translateX(-50%); width: 26px; height: 38px; filter: drop-shadow(0 0 18px rgba(255,196,0,.55)) drop-shadow(0 0 36px rgba(255,180,0,.35)); }
    .flame .teardrop{ position:absolute; inset:0; background: radial-gradient(ellipse at 50% 65%, var(--flame1) 0%, var(--flame2) 60%, rgba(255,165,0,.0) 70%); border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; transform-origin: 50% 90%; animation: flicker 1.2s ease-in-out infinite; }
    .flame .core{ position:absolute; top: 9px; left:50%; transform:translateX(-50%); width:10px; height:14px; background: radial-gradient(ellipse at 50% 60%, #fff 0%, #fff59d 70%, rgba(255,255,255,0) 80%); border-radius:50%; filter: blur(.4px); opacity:.92; }
    @keyframes flicker{
      0%,100%{ transform: rotate(-2deg) scale(1.00); filter:hue-rotate(0deg) }
      50%{ transform: rotate(3deg) scale(1.06); filter:hue-rotate(-8deg) }
    }

    .glow{ position:absolute; top:-100px; left:50%; transform: translateX(-50%); width: 220px; height: 220px; border-radius: 50%; background: radial-gradient(circle, rgba(255,218,117,.35) 0%, rgba(255,218,117,.18) 35%, rgba(255,218,117,0) 70%); filter: blur(6px); pointer-events:none; animation: pulse 2.2s ease-in-out infinite; }
    @keyframes pulse{ 0%,100%{ opacity:.9; transform: translateX(-50%) scale(1) } 50%{ opacity:.6; transform: translateX(-50%) scale(1.06) } }

    .smoke{ position:absolute; top:-16px; left:50%; transform: translateX(-50%); width:2px; height:2px; opacity:0; pointer-events:none; }
    .smoke:before, .smoke:after{
      content:""; position:absolute; left:-6px; width:14px; height:14px; border-radius:50%; background: var(--smoke); filter: blur(2px); opacity:.85; animation: rise 1.6s ease-out forwards; }
    .smoke:after{ left: 4px; width:11px; height:11px; opacity:.6; animation-delay:.12s }
    @keyframes rise{ from{ transform: translateY(8px) scale(.6); opacity:.7 } to{ transform: translate(-8px, -46px) scale(1.2); opacity:0 } }

    .candle.out .flame, .candle.out .glow{ display:none }
    .candle.out .smoke{ opacity:1 }
    .candle.relight .flame{ animation: pop-in .45s ease-out both }
    @keyframes pop-in{ 0%{ opacity:0; transform: translateX(-50%) scale(.4) translateY(10px) } 100%{ opacity:1; transform: translateX(-50%) scale(1) translateY(0) } }

    .cta{
      display:flex; justify-content:center; 
      margin-top: 70px; 
    }
    button.primary{
      padding:10px 16px; border-radius:14px; border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); color:var(--text);
      font-weight:700; letter-spacing:.3px; cursor:pointer; transition: transform .08s ease, box-shadow .2s ease; box-shadow: var(--shadow);
    }
    button.primary:hover{ transform: translateY(-1px) }

    @media (max-width: 520px){
      body {
        padding: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(600px 400px at 60% -10%, #ffdeeb 0%, var(--bg) 55%);
      }
      .app {
        width: 100vw;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
      }
      .card {
        width: 94vw;
        max-width: 340px;
        margin: 0 auto;
        padding: 18px 8px;
        border-radius: 18px;
        box-shadow: var(--shadow);
        background: linear-gradient(180deg, rgb(255, 215, 241), rgba(252, 199, 237, 0.962));
        border:1px solid #ffdeeb;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      h1 {
        font-size: 22px;
        margin: 10px 0 8px;
        line-height: 1.2;
        text-align: center;
      }
      .stage {
        height: 260px;
        margin: 0 auto 0;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        position: relative;
        width: 100%;
      }
      .cake-wrap {
        transform: translateY(0px);
        position: relative;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .cake {
        width: 220px;
        min-width: 180px;
        max-width: 240px;
        margin: 0 auto;
        position: relative;
      }
      .plate {
        width: 220px;
        min-width: 140px;
        max-width: 240px;
        height: 16px;
        margin: -6px auto 0;
        position: relative;
      }
      .candle {
        width: 18px;
        height: 70px;
        bottom: 120px;
        transform: translate(-50%, -30px);
        left: 50%;
        position: absolute;
      }
      .layer {
        height: 38px;
        border-radius: 12px;
      }
      .icing {
        height: 18px;
      }
      .drip {
        width: 12px;
      }
      .d1 { left: 14px; height: 14px; top: 10px; }
      .d2 { left: 38px; height: 10px; top: 10px; }
      .d3 { right: 24px; height: 12px; top: 10px; }
      .cta {
        margin-top: 18px;
        display: flex;
        justify-content: center;
        width: 100%;
      }
      button.primary {
        font-size: 14px;
        padding: 7px 10px;
        border-radius: 8px;
      }
      canvas#confetti {
        border-radius: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Happy Birthday, Irene!</h1>

      <div class="stage" aria-live="polite">
        <canvas id="confetti"></canvas>

        <div class="cake-wrap">
          <div class="cake" role="img" aria-label="A 3-layer birthday cake with one candle">
            <div class="layer">
              <div class="icing"></div>
              <span class="drip d1"></span><span class="drip d2"></span><span class="drip d3"></span>
            </div>
            <div class="layer">
              <div class="icing"></div>
              <span class="drip d1"></span><span class="drip d2"></span><span class="drip d3"></span>
            </div>
            <div class="layer">
              <div class="icing"></div>
              <span class="drip d1"></span><span class="drip d2"></span><span class="drip d3"></span>
            </div>
          </div>
          <div id="candle" class="candle" tabindex="0" role="button" aria-pressed="true">
            <div class="wick"></div>
            <div class="flame" aria-hidden="true">
              <div class="teardrop"></div>
              <div class="core"></div>
            </div>
            <div class="glow" aria-hidden="true"></div>
            <div class="smoke" aria-hidden="true"></div>
          </div>
          <div class="plate"></div>
        </div>
      </div>

      <div class="cta">Semoga makin banyak rezekinya, gaji 2 digit, langgeng and sehat selalu, aminn!</div>
    </div>
  </div>

  <script>
    const candle = document.getElementById('candle');
    let isLit = true;

    function extinguish(){
      if(!isLit) return;
      isLit = false;
      candle.classList.add('out');
      candle.setAttribute('aria-pressed','false');
      confettiBurst();
    }
    function relight(){
      if(isLit) return;
      candle.classList.remove('out');
      candle.classList.add('relight');
      isLit = true;
      candle.setAttribute('aria-pressed','true');
      setTimeout(()=> candle.classList.remove('relight'), 500);
    }
    candle.addEventListener('click', relight);
    candle.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); relight(); }});

    let audioCtx, analyser, dataArray, micStream;
    let rafId = null;

    async function initMic(){
      if(rafId) cancelAnimationFrame(rafId);
      if(audioCtx) try{ await audioCtx.close(); }catch{}
      try{
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 2048;
        analyser.smoothingTimeConstant = 0.85;
        dataArray = new Uint8Array(analyser.fftSize);
        micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const source = audioCtx.createMediaStreamSource(micStream);
        source.connect(analyser);
        loop();
      }catch(err){
        console.error(err);
      }
    }

    function volumeRMS(){
      analyser.getByteTimeDomainData(dataArray);
      let sum = 0;
      for(let i=0;i<dataArray.length;i++){
        const v = (dataArray[i] - 128) / 128;
        sum += v*v;
      }
      const rms = Math.sqrt(sum / dataArray.length);
      return rms;
    }

    let hot = 0;
    const REQUIRED_FRAMES = 12;

    function loop(){
      const rms = volumeRMS();
      if(rms > 0.04) hot++; else hot = Math.max(0, hot - 1);
      if(hot > REQUIRED_FRAMES){
        extinguish();
        hot = 0;
      }
      rafId = requestAnimationFrame(loop);
    }

    window.addEventListener('load', ()=>{ initMic(); });

    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    const DPR = Math.min(window.devicePixelRatio || 1, 2);
    let W, H;
    function resize(){
      const rect = canvas.getBoundingClientRect();
      W = Math.floor(rect.width * DPR); H = Math.floor(rect.height * DPR);
      canvas.width = W; canvas.height = H; ctx.scale(DPR, DPR);
    }
    window.addEventListener('resize', resize, { passive:true });
    resize();

    let parts = [];
    function spawnConfetti(n=120){
      const colors = ['#b197fc','#ff7ad9','#63e6be','#74c0fc','#fff3bf'];
      for(let i=0;i<n;i++){
        parts.push({
          x: Math.random()*canvas.clientWidth,
          y: canvas.clientHeight + Math.random()*80,
          r: 2 + Math.random()*4,
          vy: - (2 + Math.random()*3),
          vx: (Math.random()-0.5)*2,
          rot: Math.random()*Math.PI,
          vr: (Math.random()-0.5)*0.2,
          color: colors[Math.floor(Math.random()*colors.length)]
        });
      }
    }
    function confettiBurst(){
      spawnConfetti(160);
      const s = candle.querySelector('.smoke');
      s.style.animation = 'none'; s.offsetHeight;
      s.style.animation = '';
    }
    function tickConfetti(){
      ctx.clearRect(0,0,canvas.clientWidth, canvas.clientHeight);
      parts = parts.filter(p=> p.y > -20);
      for(const p of parts){
        p.x += p.vx; p.y += p.vy; p.vy += 0.03; p.rot += p.vr;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx.restore();
      }
      requestAnimationFrame(tickConfetti);
    }
    tickConfetti();
  </script>
</body>
</html>
